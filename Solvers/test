
import string_divider
import LSBSteg
from LSBSteg import encode, decode
from matplotlib.pyplot import imread
import numpy as np
import requests
api_base_url= 'http://3.70.97.142:5000/fox'
def send_message(team_id, messages, message_entities=['F', 'E', 'R']):
    myurl= f"{api_base_url}/send-message"
    myparams={"teamId": team_id, "messages": messages, "message_entities": message_entities}
    response = requests.post(url=myurl,json=myparams)
    if response.status_code == 200 or response.status_code == 201:
        response = response.json()
        print(response)
        print("send message response")
        return response
    else:
        print(response.status_code)
        print("send message response failed")
        print(response.text)
        return None

def generate_message_array(chunk, image_carrier):  
   
    
    empty=np.array(image_carrier)
    
    steg1 = np.array(image_carrier).copy()
    encoded_image1 = LSBSteg.encode(steg1,chunk)

    steg2 = np.array(image_carrier).copy()
    encoded_image2 = LSBSteg.encode(steg2,"fake")
    
   
    
    imgs=[]
    imgs.append(empty.tolist())
    imgs.append(encoded_image2.tolist())
    imgs.append(encoded_image1.tolist())
    msgentities=['E', 'F', 'R']
    '''
    In this function you will need to create your own startegy. That includes:
        1. How you are going to split the real message into chunkcs
        2. Include any fake chunks
        3. Decide what 3 chuncks you will send in each turn in the 3 channels & what is their entities (F,R,E)
        4. Encode each chunck in the image carrier  
    '''
    return imgs,msgentities
    pass 
x={}
x['msg'] = "Secrets in spectrum."
x['carrier_image']=[
        [
            [
                186,
                213,
                255
            ],
            [
                188,
                213,
                254
            ],
            [
                193,
                216,
                255
            ],
            [
                188,
                207,
                247
            ],
            [
                200,
                214,
                253
            ],
            [
                208,
                218,
                254
            ],
            [
                197,
                206,
                239
            ],
            [
                212,
                219,
                248
            ],
            [
                218,
                225,
                254
            ],
            [
                221,
                231,
                255
            ],
            [
                200,
                212,
                238
            ],
            [
                201,
                217,
                242
            ],
            [
                205,
                225,
                250
            ],
            [
                193,
                217,
                241
            ],
            [
                204,
                230,
                255
            ],
            [
                215,
                241,
                255
            ],
            [
                216,
                234,
                255
            ],
            [
                214,
                229,
                255
            ],
            [
                211,
                226,
                255
            ],
            [
                212,
                227,
                255
            ]
        ],
        [
            [
                174,
                198,
                242
            ],
            [
                191,
                214,
                255
            ],
            [
                201,
                223,
                255
            ],
            [
                195,
                213,
                251
            ],
            [
                201,
                215,
                252
            ],
            [
                209,
                222,
                255
            ],
            [
                212,
                221,
                252
            ],
            [
                223,
                232,
                255
            ],
            [
                232,
                241,
                255
            ],
            [
                239,
                248,
                255
            ],
            [
                203,
                216,
                248
            ],
            [
                182,
                197,
                230
            ],
            [
                193,
                212,
                245
            ],
            [
                196,
                218,
                255
            ],
            [
                191,
                215,
                253
            ],
            [
                191,
                214,
                255
            ],
            [
                191,
                209,
                255
            ],
            [
                189,
                207,
                255
            ],
            [
                189,
                207,
                255
            ],
            [
                192,
                210,
                255
            ]
        ],
        [
            [
                184,
                205,
                248
            ],
            [
                192,
                211,
                253
            ],
            [
                188,
                206,
                246
            ],
            [
                195,
                211,
                247
            ],
            [
                203,
                218,
                251
            ],
            [
                205,
                219,
                248
            ],
            [
                214,
                228,
                255
            ],
            [
                226,
                237,
                255
            ],
            [
                240,
                251,
                255
            ],
            [
                210,
                223,
                255
            ],
            [
                202,
                214,
                255
            ],
            [
                191,
                205,
                252
            ],
            [
                179,
                194,
                249
            ],
            [
                185,
                201,
                255
            ],
            [
                182,
                200,
                255
            ],
            [
                170,
                189,
                255
            ],
            [
                169,
                190,
                255
            ],
            [
                167,
                188,
                251
            ],
            [
                168,
                189,
                252
            ],
            [
                171,
                192,
                255
            ]
        ],
        [
            [
                185,
                206,
                253
            ],
            [
                203,
                224,
                255
            ],
            [
                200,
                219,
                255
            ],
            [
                200,
                220,
                255
            ],
            [
                201,
                222,
                253
            ],
            [
                205,
                226,
                253
            ],
            [
                226,
                248,
                255
            ],
            [
                226,
                248,
                255
            ],
            [
                194,
                215,
                244
            ],
            [
                201,
                221,
                255
            ],
            [
                195,
                213,
                255
            ],
            [
                165,
                184,
                240
            ],
            [
                165,
                184,
                252
            ],
            [
                169,
                188,
                255
            ],
            [
                148,
                166,
                250
            ],
            [
                148,
                169,
                252
            ],
            [
                163,
                187,
                255
            ],
            [
                161,
                185,
                255
            ],
            [
                161,
                186,
                253
            ],
            [
                162,
                187,
                254
            ]
        ],
        [
            [
                178,
                201,
                253
            ],
            [
                197,
                221,
                255
            ],
            [
                187,
                214,
                255
            ],
            [
                187,
                215,
                252
            ],
            [
                199,
                230,
                255
            ],
            [
                210,
                244,
                255
            ],
            [
                202,
                237,
                255
            ],
            [
                155,
                191,
                213
            ],
            [
                78,
                114,
                140
            ],
            [
                81,
                115,
                150
            ],
            [
                136,
                168,
                215
            ],
            [
                160,
                192,
                251
            ],
            [
                144,
                172,
                245
            ],
            [
                143,
                169,
                253
            ],
            [
                146,
                171,
                255
            ],
            [
                150,
                176,
                255
            ],
            [
                144,
                170,
                244
            ],
            [
                145,
                173,
                238
            ],
            [
                150,
                178,
                241
            ],
            [
                156,
                184,
                247
            ]
        ],
        [
            [
                180,
                205,
                255
            ],
            [
                172,
                198,
                249
            ],
            [
                166,
                197,
                243
            ],
            [
                178,
                212,
                250
            ],
            [
                179,
                215,
                247
            ],
            [
                157,
                199,
                223
            ],
            [
                118,
                163,
                184
            ],
            [
                71,
                118,
                138
            ],
            [
                81,
                127,
                150
            ],
            [
                67,
                114,
                144
            ],
            [
                64,
                109,
                150
            ],
            [
                95,
                136,
                188
            ],
            [
                145,
                183,
                246
            ],
            [
                150,
                186,
                255
            ],
            [
                129,
                161,
                244
            ],
            [
                135,
                164,
                242
            ],
            [
                143,
                171,
                234
            ],
            [
                150,
                177,
                230
            ],
            [
                161,
                188,
                241
            ],
            [
                173,
                201,
                251
            ]
        ],
        [
            [
                172,
                194,
                252
            ],
            [
                163,
                188,
                242
            ],
            [
                174,
                205,
                252
            ],
            [
                167,
                202,
                244
            ],
            [
                126,
                166,
                201
            ],
            [
                87,
                133,
                159
            ],
            [
                71,
                122,
                143
            ],
            [
                75,
                131,
                148
            ],
            [
                113,
                168,
                188
            ],
            [
                118,
                173,
                194
            ],
            [
                96,
                150,
                178
            ],
            [
                70,
                120,
                155
            ],
            [
                72,
                119,
                161
            ],
            [
                115,
                157,
                207
            ],
            [
                160,
                199,
                254
            ],
            [
                175,
                211,
                255
            ],
            [
                177,
                206,
                246
            ],
            [
                185,
                211,
                244
            ],
            [
                195,
                219,
                253
            ],
            [
                204,
                228,
                255
            ]
        ],
        [
            [
                161,
                181,
                240
            ],
            [
                153,
                175,
                233
            ],
            [
                152,
                179,
                232
            ],
            [
                113,
                145,
                194
            ],
            [
                81,
                120,
                163
            ],
            [
                90,
                136,
                172
            ],
            [
                96,
                147,
                178
            ],
            [
                98,
                154,
                181
            ],
            [
                152,
                208,
                233
            ],
            [
                132,
                188,
                213
            ],
            [
                88,
                144,
                171
            ],
            [
                88,
                141,
                172
            ],
            [
                89,
                138,
                171
            ],
            [
                64,
                110,
                146
            ],
            [
                95,
                137,
                175
            ],
            [
                155,
                191,
                227
            ],
            [
                195,
                224,
                254
            ],
            [
                198,
                224,
                249
            ],
            [
                200,
                226,
                251
            ],
            [
                202,
                228,
                253
            ]
        ],
        [
            [
                175,
                191,
                253
            ],
            [
                163,
                181,
                243
            ],
            [
                160,
                182,
                242
            ],
            [
                116,
                145,
                203
            ],
            [
                97,
                132,
                188
            ],
            [
                101,
                142,
                194
            ],
            [
                98,
                146,
                195
            ],
            [
                93,
                145,
                192
            ],
            [
                111,
                164,
                208
            ],
            [
                112,
                165,
                205
            ],
            [
                108,
                160,
                199
            ],
            [
                101,
                151,
                186
            ],
            [
                92,
                138,
                172
            ],
            [
                94,
                137,
                171
            ],
            [
                92,
                131,
                164
            ],
            [
                67,
                102,
                132
            ],
            [
                151,
                180,
                210
            ],
            [
                198,
                225,
                254
            ],
            [
                204,
                231,
                255
            ],
            [
                202,
                229,
                255
            ]
        ],
        [
            [
                191,
                211,
                255
            ],
            [
                180,
                202,
                252
            ],
            [
                184,
                209,
                255
            ],
            [
                126,
                157,
                211
            ],
            [
                99,
                136,
                189
            ],
            [
                97,
                140,
                193
            ],
            [
                101,
                151,
                204
            ],
            [
                110,
                163,
                215
            ],
            [
                102,
                158,
                207
            ],
            [
                93,
                150,
                195
            ],
            [
                97,
                150,
                192
            ],
            [
                101,
                153,
                190
            ],
            [
                101,
                150,
                183
            ],
            [
                97,
                142,
                171
            ],
            [
                91,
                135,
                160
            ],
            [
                88,
                128,
                154
            ],
            [
                63,
                96,
                129
            ],
            [
                173,
                202,
                236
            ],
            [
                194,
                223,
                255
            ],
            [
                197,
                226,
                255
            ]
        ],
        [
            [
                191,
                226,
                248
            ],
            [
                183,
                219,
                243
            ],
            [
                197,
                236,
                255
            ],
            [
                120,
                163,
                195
            ],
            [
                95,
                143,
                179
            ],
            [
                94,
                147,
                187
            ],
            [
                96,
                155,
                199
            ],
            [
                95,
                158,
                202
            ],
            [
                96,
                160,
                204
            ],
            [
                96,
                161,
                203
            ],
            [
                102,
                164,
                203
            ],
            [
                89,
                149,
                183
            ],
            [
                88,
                145,
                172
            ],
            [
                79,
                134,
                155
            ],
            [
                34,
                87,
                105
            ],
            [
                11,
                57,
                80
            ],
            [
                87,
                125,
                162
            ],
            [
                161,
                194,
                239
            ],
            [
                170,
                203,
                248
            ],
            [
                173,
                206,
                249
            ]
        ],
        [
            [
                198,
                237,
                244
            ],
            [
                193,
                233,
                241
            ],
            [
                206,
                250,
                255
            ],
            [
                105,
                153,
                173
            ],
            [
                80,
                131,
                158
            ],
            [
                85,
                142,
                172
            ],
            [
                94,
                154,
                191
            ],
            [
                90,
                153,
                194
            ],
            [
                96,
                161,
                203
            ],
            [
                82,
                147,
                187
            ],
            [
                93,
                157,
                193
            ],
            [
                87,
                150,
                181
            ],
            [
                80,
                140,
                168
            ],
            [
                75,
                131,
                154
            ],
            [
                83,
                139,
                156
            ],
            [
                147,
                195,
                217
            ],
            [
                153,
                192,
                225
            ],
            [
                161,
                195,
                233
            ],
            [
                173,
                205,
                243
            ],
            [
                170,
                204,
                241
            ]
        ],
        [
            [
                139,
                177,
                180
            ],
            [
                139,
                178,
                183
            ],
            [
                166,
                209,
                218
            ],
            [
                95,
                141,
                156
            ],
            [
                82,
                130,
                152
            ],
            [
                81,
                132,
                159
            ],
            [
                91,
                145,
                179
            ],
            [
                90,
                148,
                185
            ],
            [
                94,
                152,
                190
            ],
            [
                83,
                141,
                179
            ],
            [
                93,
                151,
                189
            ],
            [
                84,
                140,
                175
            ],
            [
                80,
                133,
                165
            ],
            [
                84,
                135,
                164
            ],
            [
                99,
                149,
                174
            ],
            [
                163,
                208,
                229
            ],
            [
                145,
                180,
                199
            ],
            [
                162,
                194,
                209
            ],
            [
                196,
                225,
                239
            ],
            [
                185,
                217,
                230
            ]
        ],
        [
            [
                108,
                137,
                119
            ],
            [
                85,
                116,
                98
            ],
            [
                106,
                138,
                125
            ],
            [
                88,
                124,
                114
            ],
            [
                101,
                140,
                135
            ],
            [
                92,
                132,
                131
            ],
            [
                94,
                138,
                141
            ],
            [
                92,
                137,
                143
            ],
            [
                101,
                148,
                158
            ],
            [
                104,
                151,
                161
            ],
            [
                107,
                151,
                162
            ],
            [
                87,
                131,
                140
            ],
            [
                90,
                130,
                138
            ],
            [
                94,
                133,
                140
            ],
            [
                61,
                100,
                105
            ],
            [
                42,
                78,
                76
            ],
            [
                65,
                95,
                83
            ],
            [
                91,
                118,
                101
            ],
            [
                114,
                141,
                122
            ],
            [
                123,
                150,
                131
            ]
        ],
        [
            [
                146,
                160,
                101
            ],
            [
                113,
                127,
                68
            ],
            [
                101,
                116,
                59
            ],
            [
                98,
                117,
                61
            ],
            [
                118,
                139,
                83
            ],
            [
                117,
                140,
                88
            ],
            [
                130,
                154,
                104
            ],
            [
                127,
                153,
                106
            ],
            [
                126,
                154,
                106
            ],
            [
                110,
                137,
                92
            ],
            [
                111,
                138,
                93
            ],
            [
                122,
                148,
                103
            ],
            [
                121,
                144,
                100
            ],
            [
                114,
                135,
                92
            ],
            [
                115,
                136,
                93
            ],
            [
                126,
                145,
                99
            ],
            [
                119,
                140,
                84
            ],
            [
                105,
                125,
                66
            ],
            [
                110,
                130,
                69
            ],
            [
                113,
                133,
                72
            ]
        ],
        [
            [
                112,
                119,
                39
            ],
            [
                119,
                126,
                46
            ],
            [
                123,
                132,
                53
            ],
            [
                129,
                140,
                62
            ],
            [
                138,
                150,
                74
            ],
            [
                142,
                156,
                81
            ],
            [
                164,
                180,
                105
            ],
            [
                159,
                175,
                102
            ],
            [
                142,
                160,
                86
            ],
            [
                129,
                147,
                73
            ],
            [
                130,
                147,
                76
            ],
            [
                146,
                162,
                91
            ],
            [
                138,
                151,
                82
            ],
            [
                122,
                135,
                66
            ],
            [
                125,
                136,
                68
            ],
            [
                121,
                134,
                65
            ],
            [
                136,
                152,
                79
            ],
            [
                111,
                128,
                50
            ],
            [
                149,
                166,
                88
            ],
            [
                141,
                158,
                80
            ]
        ],
        [
            [
                133,
                145,
                63
            ],
            [
                150,
                161,
                82
            ],
            [
                144,
                157,
                78
            ],
            [
                147,
                159,
                83
            ],
            [
                139,
                152,
                80
            ],
            [
                152,
                165,
                95
            ],
            [
                144,
                160,
                89
            ],
            [
                147,
                163,
                92
            ],
            [
                138,
                154,
                83
            ],
            [
                146,
                162,
                91
            ],
            [
                151,
                167,
                94
            ],
            [
                175,
                188,
                118
            ],
            [
                142,
                155,
                86
            ],
            [
                115,
                128,
                59
            ],
            [
                140,
                151,
                85
            ],
            [
                129,
                141,
                75
            ],
            [
                122,
                137,
                70
            ],
            [
                120,
                137,
                67
            ],
            [
                144,
                159,
                90
            ],
            [
                164,
                180,
                109
            ]
        ],
        [
            [
                141,
                154,
                74
            ],
            [
                148,
                161,
                82
            ],
            [
                147,
                161,
                84
            ],
            [
                150,
                163,
                91
            ],
            [
                142,
                155,
                86
            ],
            [
                136,
                148,
                82
            ],
            [
                128,
                143,
                76
            ],
            [
                134,
                149,
                82
            ],
            [
                143,
                158,
                89
            ],
            [
                142,
                158,
                87
            ],
            [
                142,
                155,
                85
            ],
            [
                153,
                166,
                96
            ],
            [
                133,
                146,
                77
            ],
            [
                124,
                136,
                70
            ],
            [
                158,
                168,
                105
            ],
            [
                166,
                178,
                116
            ],
            [
                165,
                180,
                115
            ],
            [
                116,
                132,
                67
            ],
            [
                104,
                119,
                54
            ],
            [
                128,
                143,
                76
            ]
        ],
        [
            [
                123,
                136,
                57
            ],
            [
                121,
                133,
                57
            ],
            [
                133,
                146,
                74
            ],
            [
                140,
                153,
                84
            ],
            [
                135,
                150,
                83
            ],
            [
                111,
                126,
                61
            ],
            [
                111,
                125,
                63
            ],
            [
                120,
                134,
                72
            ],
            [
                123,
                138,
                73
            ],
            [
                129,
                144,
                77
            ],
            [
                145,
                160,
                93
            ],
            [
                154,
                169,
                102
            ],
            [
                150,
                162,
                98
            ],
            [
                137,
                149,
                87
            ],
            [
                144,
                154,
                94
            ],
            [
                154,
                165,
                105
            ],
            [
                153,
                169,
                106
            ],
            [
                101,
                120,
                54
            ],
            [
                86,
                102,
                37
            ],
            [
                107,
                123,
                58
            ]
        ],
        [
            [
                97,
                109,
                33
            ],
            [
                94,
                106,
                32
            ],
            [
                121,
                134,
                64
            ],
            [
                127,
                139,
                73
            ],
            [
                128,
                143,
                78
            ],
            [
                97,
                111,
                49
            ],
            [
                105,
                119,
                58
            ],
            [
                112,
                126,
                64
            ],
            [
                123,
                137,
                75
            ],
            [
                128,
                143,
                78
            ],
            [
                149,
                164,
                97
            ],
            [
                146,
                161,
                94
            ],
            [
                151,
                163,
                101
            ],
            [
                137,
                149,
                87
            ],
            [
                131,
                140,
                83
            ],
            [
                147,
                158,
                98
            ],
            [
                145,
                161,
                99
            ],
            [
                126,
                145,
                81
            ],
            [
                126,
                142,
                77
            ],
            [
                132,
                148,
                83
            ]
        ]
    ]
encoded=[]
budget=7
message_array = string_divider.divide_string(x['msg'],budget)

for chunk in message_array:
    msgs,entities=generate_message_array(chunk, x['carrier_image'])
    
    print(msgs[1])
    encoded.append(msgs)
    send_message(1,msgs,entities)
    

    

    
    
    
    
